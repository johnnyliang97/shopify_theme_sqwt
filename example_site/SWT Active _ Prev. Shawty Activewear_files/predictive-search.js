import{VariantSiblingRequestHandler as RequestHandler}from"./product-card-variant-siblings.js";if(!customElements.get("predictive-search")){class e extends HTMLElement{constructor(){super(),this.input=this.querySelector('input[type="search"]'),this.resultsContainer=this.querySelector(".js-results-container"),this.initialBody=this.querySelector(".search__body").innerHTML,this.limit=this.getAttribute("data-limit"),this.beforeSearchComponent=this.querySelector(".search__body-before-search"),this.btnSubmit=this.querySelector(".js-btn-submit"),this.btnClearText=this.querySelector(".js-btn-clear-text"),this.errorMessageContainer=this.querySelector(".js-message-error"),this.errorMessageText=this.errorMessageContainer.querySelector("[data-text]"),this.timeout=null,this.isOpen=!1,this.drawer=this.closest(".js-drawer");var e=document.querySelector(".drawer__content--search"),t=document.querySelector(".search-drawer__suggestions");this.input.addEventListener("input",s=>{const i=this.input.value.trim();if(i.length<=0)return this.close(),window.innerWidth<990&&(e.style.height="auto"),void(t&&(t.style.display="block"));this.isOpen=!0,clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.getSearchResults(i),window.innerWidth<=990&&(e.style.height="100%"),t&&(t.style.display="none")},300)}),this.input.addEventListener("keydown",e=>{"Escape"===e.key&&(this.input.value?this.close():this.drawer&&this.drawer.parentElement.parentElement.toggleDrawer())}),this.btnClearText.addEventListener("click",()=>this.close())}async getSearchResults(e){try{const t=await fetch(`${Shopify.routes.root}search/suggest?q=${e}&resources[type]=product,collection,page,article,query&resources[limit]=${this.limit}&resources[limit_scope]=each&section_id=predictive-search`);if(!this.isOpen)return;if(!t.ok){throw new Error(t.status)}const s=await t.text(),i=(new DOMParser).parseFromString(s,"text/html").querySelector("#shopify-section-predictive-search"),r=i.innerHTML;try{const e=i.querySelectorAll("img"),t=Array.from(e).map(e=>e.src);await RequestHandler.preloadImagesAsync(t),this.resultsContainer.innerHTML=r,this.open(),document.querySelector("quick-cart-drawer")?.initTriggers()}catch(e){console.error("Error loading images:",e),this.errorMessageText.textContent="Error loading search results",this.errorMessageContainer.classList.remove("hidden")}}catch(e){this.errorMessageText.textContent=e.message,this.errorMessageContainer.classList.remove("hidden")}}open(){this.imagesInitialized||(this.beforeSearchComponent.classList.add("images-initialized"),this.imagesInitialized=!0),this.classList.add("is-open"),this.resultsContainer.classList.remove("hidden"),this.errorMessageContainer.classList.add("hidden"),this.btnSubmit.setAttribute("tabindex","-1"),this.btnClearText.removeAttribute("disabled"),this.beforeSearchComponent.classList.add("hidden")}close(){this.isOpen=!1,this.classList.remove("is-open"),this.resultsContainer.classList.add("hidden"),this.errorMessageContainer.classList.add("hidden"),this.input.value="",this.input.focus(),this.btnSubmit.removeAttribute("tabindex"),this.btnClearText.setAttribute("disabled",!0),this.beforeSearchComponent.classList.remove("hidden")}}customElements.define("predictive-search",e)}