const getSectionData=(e,t,r)=>({id:e,section:t,selector:r}),cartDrawer=document.querySelector("cart-drawer");let sectionsToRender=[];if(cartDrawer){const e=document.getElementById("main-cart-items")?.dataset.id;sectionsToRender=e?[getSectionData(`#shopify-section-${e}`,e,`#shopify-section-${e} cart-items`),getSectionData("#cart-counter","cart-counter","#shopify-section-cart-counter"),getSectionData("#CartDrawer-Body","cart-drawer","#shopify-section-cart-drawer #CartDrawer-Body")]:[getSectionData("#CartDrawer-Body","cart-drawer","#shopify-section-cart-drawer #CartDrawer-Body")]}else{const e=document.getElementById("main-cart-items")?.dataset.id;sectionsToRender=e?[getSectionData(`#shopify-section-${e}`,e,`#shopify-section-${e} cart-items`),getSectionData("#cart-counter","cart-counter","#shopify-section-cart-counter")]:[]}class CartRemoveButton extends HTMLElement{constructor(){super(),this.addEventListener("click",e=>{e.preventDefault();(this.closest("cart-drawer-items")||this.closest("cart-items")).updateQuantity(this.dataset.index,0)})}}customElements.define("cart-remove-button",CartRemoveButton);class CartItems extends HTMLElement{constructor(){super(),this.freeShipping=document.querySelectorAll("shipping-bar"),this.currentItemCount=Array.from(this.querySelectorAll('[name="updates[]"]')).reduce((e,t)=>e+parseInt(t.value),0),this.debouncedOnChange=debounce(e=>{this.onChange(e)},300),this.addEventListener("change",this.debouncedOnChange.bind(this)),updateFreeShipping()}calculateTotalItemCount(e){return e.reduce((e,t)=>e+t.quantity,0)}onChange(e){"updates[]"===e.target.name&&(e.target.setAttribute("data-prev-value",e.target.defaultValue||e.target.value),this.updateQuantity(e.target.dataset.index,e.target.value,document.activeElement.getAttribute("name"),e.target))}getSectionsToRender(){return sectionsToRender}updateQuantity(e,t,r,n=null){this.classList.add("is-loading"),document.querySelectorAll('[name="checkout"]').forEach(e=>e.disabled=!0);const s=JSON.stringify({line:e,quantity:t,sections:this.getSectionsToRender().map(e=>e.section),sections_url:window.location.pathname});fetch(`${routes.cart_change_url}`,{...fetchConfig(),body:s}).then(e=>e.text()).then(async t=>{const s=JSON.parse(t);if(this.getSectionsToRender()?.forEach(e=>{const t=document.querySelector(e.selector)||document.querySelector(e.id);t?s.errors||(t.innerHTML=this.getSectionInnerHTML(s.sections[e.section],e.selector)):console.error(`Element with selector ${e.selector} not found`)}),document.querySelectorAll('[name="checkout"]').forEach(e=>e.disabled=!0),s.errors||(this.totalItemCount=this.calculateTotalItemCount(s.items)),this.updateLiveRegions(e,s.item_count,s.errors),s.errors&&n){const e=n.getAttribute("data-prev-value");null!==e&&n.value!==e&&(n.value=e,n.dispatchEvent(new Event("change",{bubbles:!0})))}const o=document.getElementById(`CartItem-${e}`);o&&o.querySelector(`[name="${r}"]`)&&o.querySelector(`[name="${r}"]`).focus(),updateCartCounters(),await updateFreeShipping()}).finally(()=>this.classList.remove("is-loading"))}getSectionInnerHTML(e,t){return(new DOMParser).parseFromString(e,"text/html").querySelector(t).innerHTML}updateLiveRegions(e,t,r){r&&document.querySelectorAll(`[data-line-item-error][data-line="${e}"]`).forEach(e=>{e.innerHTML=r}),this.currentItemCount=t}}customElements.define("cart-items",CartItems);class CartDrawer extends HTMLElement{constructor(){super(),this.addEventListener("keyup",e=>"ESCAPE"===e.code.toUpperCase()&&this.close()),this.setCartLink(),this.parentElement.addEventListener("shopify:section:select",()=>this.open()),this.parentElement.addEventListener("shopify:section:deselect",()=>this.close())}connectedCallback(){"#cart-open"===window.location.hash&&this.open()}setCartLink(){const e=document.querySelector("[data-cart-link]");e?(e.setAttribute("role","button"),e.setAttribute("aria-haspopup","dialog"),e.addEventListener("click",t=>{t.preventDefault(),this.open(e)}),e.addEventListener("keydown",t=>{"SPACE"===t.code.toUpperCase()&&(t.preventDefault(),this.open(e))})):console.error("Cart link not found")}open(e){e&&this.setActiveElement(e),this.classList.add("is-visible"),document.querySelector("body").style.overflow="hidden",this.addEventListener("transitionend",()=>{this.focusOnCartDrawer()},{once:!0}),setTimeout(()=>{document.addEventListener("click",this.handleOutsideClick)},100);const t=document.querySelector(".product-recommendations");t&&(t.classList.contains("hidden")?document.querySelector(".cart-drawer-items").classList.add("cart-drawer-items__full"):document.querySelector(".cart-drawer-items").classList.remove("cart-drawer-items__full"))}close(){this.classList.remove("is-visible"),document.querySelector("body").style.overflow="auto",removeTrapFocus(this.activeElement),document.removeEventListener("click",this.handleOutsideClick);if(!header.classList.contains("menu-open")&&"/cart"===window.location.pathname){const e=document.getElementById("CartDrawer-FormSummary");e&&e.submit()}}handleOutsideClick=e=>{const t=this.querySelector(".cart-drawer__inner");t&&!t.contains(e.target)&&this.close()};setActiveElement(e){this.activeElement=e}focusOnCartDrawer(){const e=this.firstElementChild,t=this.querySelector("[data-drawer-close]");trapFocus(e,t)}renderContents(e,t=!0){this.getSectionsToRender()?.forEach(t=>{const r=document.querySelector(t.id);r&&(r.innerHTML=this.getSectionInnerHTML(e.sections[t.section],t.selector),updateCartCounters())}),t&&this.open()}getSectionsToRender(){return sectionsToRender}getSectionInnerHTML(e,t){return(new DOMParser).parseFromString(e,"text/html").querySelector(t).innerHTML}}customElements.define("cart-drawer",CartDrawer);class CartDrawerItems extends CartItems{getSectionsToRender(){return sectionsToRender}}customElements.define("cart-drawer-items",CartDrawerItems);