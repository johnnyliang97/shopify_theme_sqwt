var aliaLauncher=function(D){"use strict";var Qt=Object.defineProperty;var zt=(D,A,L)=>A in D?Qt(D,A,{enumerable:!0,configurable:!0,writable:!0,value:L}):D[A]=L;var v=(D,A,L)=>zt(D,typeof A!="symbol"?A+"":A,L);function A(e,t){throw new Error(`Unhandled discriminated union member: ${JSON.stringify(e)}`)}const L="x-alia-jwt",Ne="x-alia-shop",Oe="x-alia-shopify-customer-id",_e="x-alia-preview-key",be={Africa:["AO","BF","BI","BJ","BW","CD","CF","CG","CI","CM","CV","DJ","DZ","EG","EH","ER","ET","GA","GH","GM","GN","GQ","GW","IO","KE","KM","LR","LS","LY","MA","MG","ML","MR","MU","MW","MZ","NA","NE","NG","RE","RW","SC","SD","SL","SN","SO","SS","ST","SZ","TD","TG","TN","TZ","UG","YT","ZA","ZM","ZW"],Antarctica:["AQ","BV","GS","HM","TF"],Asia:["AF","AE","AM","AZ","BD","BH","BN","BT","CN","CY","GE","HK","ID","IL","IN","IQ","IR","JP","JO","KH","KG","KP","KR","KW","KZ","LA","LB","LK","MN","MO","MM","MV","MY","NP","OM","PH","PK","PS","QA","RU","SA","SG","SY","TH","TJ","TL","TM","TR","TW","UZ","VN","YE"],Europe:["AD","AL","AT","AX","BA","BE","BG","BY","CH","CZ","DE","DK","EE","ES","FI","FO","FR","GB","GG","GI","GR","HR","HU","IE","IM","IS","IT","JE","LI","LT","LU","LV","MC","MD","ME","MK","MT","NL","NO","PL","PT","RO","RS","RU","SE","SI","SJ","SK","SM","TR","UA","VA","XK"],"North America":["AG","AI","AW","BB","BL","BM","BQ","BS","BZ","CA","CR","CU","CW","DM","DO","GD","GL","GP","GT","HN","HT","JM","KN","KY","LC","MF","MQ","MS","MX","NI","PA","PM","PR","SV","SX","TC","TT","US","VC","VG","VI"],Oceania:["AS","AU","CC","CK","CX","FJ","FM","GU","KI","MH","MP","NC","NF","NR","NU","NZ","PF","PG","PN","PW","SB","TK","TO","TV","UM","VU","WF","WS"],"South America":["AR","BO","BR","CL","CO","EC","FK","GF","GY","PE","PY","SR","UY","VE"]},Me=["AT","BE","BG","HR","CH","CY","CZ","DK","EE","FI","FR","DE","GB","GR","HU","IE","IS","IT","LI","LV","LT","LU","MT","NO","NL","PL","PT","RO","SK","SI","ES","SE"],Ue="_allEUCountries";function Fe(e){return e===Ue}function ee(e){return e.flatMap(t=>Fe(t)?Me:[t])}function Ge(e){if(e.length===0)return[];const t=new Set;for(const n of e){const r=be[n];r&&r.forEach(s=>t.add(s))}return Array.from(t)}function Ke(e,t){return new RegExp("^"+e.replace(/([.?+^$[\]\\(){}|/-])/g,"\\$1").replace(/\*/g,".*")+"$").test(t)}const te=e=>e==="local"?localStorage:sessionStorage;function b(e,t){try{const r=te(e).getItem(t);if(!r||r==="undefined")return null;const s=JSON.parse(r);return s==="undefined"?null:s??null}catch(n){return console.error(`Error getting ${t} from ${e}Storage:`,n),null}}function W(e,t,n){try{te(e).setItem(t,JSON.stringify(n))}catch(r){console.error(`Error setting ${t} in ${e}Storage:`,r)}}function M(e){return typeof e=="string"?e:e instanceof Error?e.message:typeof e=="object"&&e!==null&&"error"in e&&typeof e.error=="string"?e.error:"An unknown error occurred"}function Y(e){try{return new URL(e)}catch{return}}async function N(e){return new Promise(t=>setTimeout(t,e))}async function ne(e,t){return Promise.race([N(e),t()])}const C=()=>document;function w(e){return window[e]}function U(e,t){window[e]=t}const re="ALIA_DISABLE_ANALYTICS_TRACKING";function Be(){U(re,!0)}function Ve(){return w(re)}function $e(){try{const e=w("ALIA_PROFILE_PROPERTIES");return e&&typeof e=="object"&&!Array.isArray(e)?Object.fromEntries(Object.entries(e).filter(([,t])=>t!=null).map(([t,n])=>[t,String(n)])):void 0}catch{return}}function He(e){const t=$e();t&&(e={...t,...e}),U("ALIA_PROFILE_PROPERTIES",e)}function We(e){const t=u(e)?e:[],n=new Map;function r(...o){var c;t.push(...o);for(const S of o)(c=n.get(S.type))==null||c.forEach(p=>p(S))}function s({type:o,callback:c,retroactive:S=!1}){const p=c,I=n.get(o)??[];return I.push(p),n.set(o,I),S&&t.filter(k=>k.type===o).forEach(p),()=>{n.set(o,I.filter(T=>T!==c))}}function i(o){r({type:"open",triggerID:o})}function a(){r({type:"close"})}return s({type:"disableAnalyticsTracking",callback:()=>Be(),retroactive:!0}),s({type:"setProperties",callback:({properties:o})=>He(o),retroactive:!0}),{push:r,listen:s,open:i,close:a};function l(o){return typeof o=="object"&&o!==null&&"type"in o&&typeof o.type=="string"}function u(o){return Array.isArray(o)&&o.every(l)}}const Ye="alia:";function Je(e){const t=Ye+e.type,n=new CustomEvent(t,{detail:e});C().dispatchEvent(n)}async function je(e){return new Promise((t,n)=>{const r=C().createElement("script");r.src=e,r.async=!0,r.onload=()=>t(r),r.onerror=()=>n(new Error("Failed to load Alia script")),C().head.appendChild(r)})}class Ze{constructor(){v(this,"debugExtensionEnabled",!1);v(this,"appName","launcher");window.postMessage({type:"alia:loaded"},"*"),window.addEventListener("message",t=>{t.data&&t.data.type==="alia:debug_extension_enabled"&&(this.debugExtensionEnabled=!0)})}log(...t){console.log(`[Alia ${this.appName}]`,...t)}debug(...t){this.debugExtensionEnabled&&console.log(`%c[Alia ${this.appName} debug]`,"color: cyan",...t)}error(...t){console.error(`[Alia ${this.appName}]`,...t)}}const y=new Ze;function se(e){try{e()}catch(t){y.error(t)}}function ie({onLinkClick:e,onHistoryChange:t}){C().addEventListener("click",s=>{if(s.target instanceof HTMLElement){const i=s.target.closest("a");i&&(e==null||e(i))}});const n=history.pushState;history.pushState=function(s,i,a){let l;try{l=t==null?void 0:t(a)}catch(u){y.debug("Error intercepting navigation",u)}return n.call(this,s,i,l??a)};const r=history.replaceState;history.replaceState=function(s,i,a){let l;try{l=t==null?void 0:t(a)}catch(u){y.debug("Error intercepting navigation",u)}return r.call(this,s,i,l??a)}}const ae="alia-jwt";async function P({method:e,path:t,args:n,headers:r,keepAlive:s}){var p;const i=e!=="GET"&&"body"in n,a=Xe(),{key:l}=O(),u=(p=F())==null?void 0:p.customerID,o=await fetch(S(t,"params"in n&&n.params,"query"in n&&n.query),{method:e,keepalive:s,headers:{...i?{"Content-Type":"application/json"}:{},[Ne]:H(),...a?{[L]:a}:{},...l?{[_e]:l}:{},...u?{[Oe]:u}:{},...r},...i?{body:JSON.stringify("body"in n?n.body:void 0)}:{}});if(o.status===204)return;const c=await o.json();if(o.ok)return c;throw typeof c!="object"||c==null?new Error("An unknown error occurred"):"error"in c&&typeof c.error=="string"?new Error(c.error):new Error("An unknown error occurred");function S(I,T,k){const R=new URL("https://backend.alia-cloudflare.com");for(const[G,_]of Object.entries(T))I=I.replace(`:${G}`,String(_));R.pathname=`/launcher${I}`;for(const[G,_]of Object.entries(k))_!=null&&R.searchParams.set(G,String(_));return R.toString()}}const xe=(()=>{const e={};return{setItem:(t,n)=>{e[t]=n},getItem:t=>e[t]}})();function oe(){const e=[sessionStorage,xe];return O().key||e.unshift(localStorage),e}function ue(e){for(const t of oe())try{t.setItem(ae,e)}catch{}}function Xe(){for(const e of oe())try{const t=e.getItem(ae);if(t)return t}catch{}return null}function O(){const e="alia_preview_key",t=new URLSearchParams(window.location.search),n=t.get("alia_preview_key");n&&sessionStorage.setItem(e,n);const r=t.get("flow_id"),s=r?parseInt(r):void 0;return{key:sessionStorage.getItem(e),flowID:Number.isNaN(s)?void 0:s}}function J(){return O().key?"session":"local"}const ce="alia_user";function qe(){se(()=>{const t=new URL(window.location.href).searchParams.get(ce);if(t){const n=atob(t);ue(n)}return null})}function Qe(e,t){se(()=>{const n=[(t==null?void 0:t.primaryDomain)??"",...(t==null?void 0:t.otherDomains)??[]].filter(i=>!!i);if(n.length<=1)return;const r=n.map(i=>new URL(i)).filter(i=>i.hostname!==window.location.hostname),s=i=>(i.searchParams.set(ce,btoa(e)),i);ie({onLinkClick:i=>{r.some(a=>a.hostname===i.hostname)&&(i.href=s(new URL(i.href)).toString())},onHistoryChange:i=>{if(i)return s(new URL(i)).toString()}})})}function j(e){return P({method:"POST",path:"/errors",args:{body:e}})}async function ze(e){return await P({method:"POST",path:"/user-flows",args:{body:e}})}async function et(e){return await P({method:"POST",path:"/user-flows/preview",args:{body:e}})}async function tt(e){return await P({method:"POST",path:"/users",args:{query:e}})}async function nt(e){return await P({method:"POST",path:"/user-actions",args:{body:e}})}const Z="alia-user-actions";function rt(e){const t=[...e],n=b(J(),Z)??[];for(const r of n)r.id&&t.some(s=>s.id===r.id)||t.push(r);return t}class st{constructor(t){v(this,"mediator");this.mediator=t,window.addEventListener("pageshow",()=>{this.loadFromStorage()})}setActions(t){const n=this.mediator.update(r=>({...r,actions:t(r.actions)}));W(J(),Z,n.actions)}loadFromStorage(){const t=b(J(),Z);t&&this.setActions(()=>[...t])}addActions(...t){this.setActions(n=>[...n,...t])}updateByCreatedAt(t,n){this.setActions(r=>r.map(s=>s.createdAt===t&&s.type===n.type?n:s))}async createAction(t){try{const n=new Date().toISOString();this.addActions({...t,type:t.data.type,createdAt:n});const r=await nt(t);this.updateByCreatedAt(n,r)}catch(n){j({message:`Failed to create ${t.data.type} user action`,data:{action:t,error:M(n)}})}}}class it{constructor(t){v(this,"state");v(this,"subscriptions",[]);v(this,"userActionsStore");this.state=t,this.userActionsStore=new st(this)}update(t){return this.state={...this.state,...t(this.state)},this.subscriptions.forEach(n=>n(this.state)),this.state}subscribe(t){return this.subscriptions.push(t),()=>{this.subscriptions=this.subscriptions.filter(n=>n!==t)}}}let K;window.addEventListener("message",e=>{e.data&&e.data.type==="alia:user_overrides"&&(K=e.data.overrides)});function at(){try{if(!K||typeof K!="object")return;const e=K,t=r=>r in e?e[r]:void 0,n=r=>typeof r=="string"?r:void 0;return{country:n(t("country")),market:n(t("market")),language:n(t("language")),ipCountry:n(t("ipCountry")),ipRegion:n(t("ipRegion")),ipCity:n(t("ipCity"))}}catch(e){y.error("Failed to get overrides",e);return}}function x(e){return`alia-session${e?`-${e}`:""}`}function le(e=null){return b("session",x(e))??{start:Date.now(),isEngaged:!1}}class ot{constructor(t,n){v(this,"isNewSession");v(this,"flowID",null);v(this,"onEngaged",null);this.flowID=t??null,this.onEngaged=n??null,this.setupEngagedListeners(),b("session",x(this.flowID))?this.isNewSession=!1:(this.isNewSession=!0,this.setValue({start:Date.now(),isEngaged:!1}))}getValue(){return le(this.flowID)}setValue(t){W("session",x(this.flowID),t)}setupEngagedListeners(){ie({onLinkClick:t=>{t.href&&t.hostname===window.location.hostname&&this.handleEngagedSession()},onHistoryChange:()=>{this.handleEngagedSession()}})}handleNewSession(){this.isNewSession}handleEngagedSession(){var n;const t=this.getValue();t.isEngaged||(this.setValue({...t,isEngaged:!0}),(n=this.onEngaged)==null||n.call(this))}}async function fe(e){Ve()||await P({method:"POST",path:"/events/flow",args:e,keepAlive:!0})}class de{constructor(t){v(this,"tracker");v(this,"flowID",null);this.flowID=t??null,this.tracker=new ot(t,()=>{fe({query:{metric:"ENGAGED_SESSION"},body:{flowID:this.flowID}})})}handleNewSession(){this.tracker.isNewSession&&fe({query:{metric:"SESSION"},body:{flowID:this.flowID}})}}const ut=Symbol("NO_EVAL");function ct(e,t=!1){try{return lt(e,t)}catch(n){return y.error("Error executing code",{code:e,error:M(n)}),null}}function lt(e,t=!1){return!t&&w(ut)===!0?void 0:new Function(e)()}async function ft(e){return await P({method:"GET",path:"/integrations/klaviyo-oauth/lists",args:{query:e}})}async function dt(e){return await P({method:"GET",path:"/integrations/klaviyo-oauth/segments",args:{query:e}})}async function gt(e){const t=await me("klaviyo");return t==="skip"||e.type==="klaviyo.identified"?t:!t}async function yt(){try{const{klaviyo:t}=await e(),n=await ne(1e3,async()=>await(t==null?void 0:t.isIdentified()));return n===void 0?void 0:n===!0}catch{return}async function e(){try{if(!Array.from(C().scripts).find(s=>s.src.includes("klaviyo.js")))return{klaviyo:void 0};const n=()=>w("klaviyo");return n()?{klaviyo:n()}:await ne(1e3,async()=>await new Promise(s=>{const i=setInterval(()=>{n()&&(s({klaviyo:n()}),clearInterval(i))},100)}))??{klaviyo:void 0}}catch{return{klaviyo:void 0}}}}async function pt(e){if(!e.listID)return!0;const t=e.listID,n=await ht();return(n==null?void 0:n.includes(t))??e.fallback?e.type==="klaviyo.inList":e.type==="klaviyo.notInList"}async function mt(e){if(!e.segmentID)return!0;const t=e.segmentID,n=await wt();return(n==null?void 0:n.includes(t))??e.fallback?e.type==="klaviyo.inSegment":e.type==="klaviyo.notInSegment"}let B;async function ht(){try{if(B)return await B;const e=ge();return e?(B=Promise.race([ft({exchangeID:e}),N(2e3)]),await B):void 0}catch(e){y.error(e);return}}let V;async function wt(){try{if(V)return await V;const e=ge();return e?(V=Promise.race([dt({exchangeID:e}),N(2e3)]),await V):void 0}catch(e){y.error(e);return}}function ge(){const t=s(C().cookie).__kla_id;if(!t)return;const n=JSON.parse(atob(t));if(!n||typeof n!="object")return;const r=Object.hasOwn(n,"$exchange_id")?n.$exchange_id:void 0;if(typeof r!="string")return;return r;function s(i){const a=i.split(";"),l={};for(let u=0;u<a.length;u++){const c=a[u].trim().split("=");if(c.length>1){const S=c[0],p=decodeURIComponent(c.slice(1).join("="));l[S]=p}}return l}}async function St(e,t){var s,i,a,l;if(t.evaluated.includes(e.resource.id))return"skip";const n=e.resource.type==="targetingRule"?(i=(s=t.targetingRules)==null?void 0:s.rules.find(u=>u.id===e.resource.id))==null?void 0:i.config:(l=(a=t.segments.find(u=>u.id===e.resource.id))==null?void 0:a.targeting)==null?void 0:l.rule;if(!n)return"skip";const r=await q(n,{...t,evaluated:[...t.evaluated,e.resource.id]});return r!=="skip"?e.type==="inTargetingRule"?r:!r:e.resource.type==="segment"&&e.type==="notInTargetingRule"?!1:"skip"}async function It(e,t){return await Promise.race([ct(`return (async ({ campaignID, profile: { user, actions } }) => { ${e.code} 
 })(${JSON.stringify({campaignID:t.segmentID,profile:t})})`),N(1e3)])===!0}const ye={klaviyo:async()=>await yt(),smsbump:async()=>{var e,t;return(t=(e=w("smsbump"))==null?void 0:e.isIdentified)==null?void 0:t.call(e)},unveild:async()=>{var e,t;return(t=(e=w("unveild"))==null?void 0:e.checkIfUserIdentified)==null?void 0:t.call(e)},upstack:async()=>{var e,t;return await((t=(e=w("_upsShopifyClient"))==null?void 0:e.isKnown)==null?void 0:t.call(e))},tie:async()=>{if(!Array.isArray(w("dataLayer")))return!1;for(const e of w("dataLayer"))if(e&&e.rrid_response&&Array.isArray(e.rrid_response.results))for(const{columns:t,data:n}of e.rrid_response.results){if(!Array.isArray(t)||!Array.isArray(n))continue;const r=t.indexOf("party_source");if(r!==-1){for(const{row:s}of n)if(Array.isArray(s)&&s[r]===1)return!0}}return!1}},pe="alia-cookie-results",$=b("session",pe)??{};async function vt(e){const n=(await Promise.all(Object.keys(ye).filter(r=>!e.exclude.includes(r)).map(async r=>await me(r)))).some(r=>r===!0);return e.type==="cookie.identified"?n:!n}async function me(e){try{if($[e]!==void 0)return $[e];const n=await t();return $[e]=n,W("session",pe,$),n}catch{return"skip"}async function t(){const n=await ye[e]();return n===!0?!0:n===!1?!1:"skip"}}function X(e,t){switch(e.operator){case"eq":return t===e.value;case"neq":return t!==e.value;case"gt":return t>e.value;case"gte":return t>=e.value;case"lt":return t<e.value;case"lte":return t<=e.value}}function he(e,t){const n=e.value*s(e.unit),r=Date.now()-t.getTime();switch(e.operator){case"gt":return r>n;case"lt":return r<n}function s(i){let a=1e3;if(i==="seconds"||(a*=60,i==="minutes")||(a*=60,i==="hours")||(a*=24,i==="days"))return a;if(i==="weeks")return a*7;if(a*=30,i==="months"||(a*=12,i==="years"))return a;A(i)}}function At(e,{user:t},n){const s=(e.type==="hasNotVisitedPage"||e.type==="hasVisitedPage")&&t.profile.history?t.profile.history.flat().map(u=>Y(u)):[Y(window.location.href)],a=(e.matchType==="exact"?e.values:e.matchType==="contains"?e.values.map(u=>`*${u}*`):A(e.matchType)).some(u=>s.some(o=>o&&l(e.pageType,o,u)));return e.type==="hasVisitedPage"||e.type==="isOnPage"?a:!a;function l(u,o,c){const S=u==="url"?o.toString():u==="path"?o.pathname+o.search+o.hash:A(u);return Ke(p(c),p(S));function p(I){return I.replace(/\/$/,"")}}}function Et(e,{user:t}){var r;const n=(r=t.profile.history)==null?void 0:r.at(-1);return n?X(e.value,n.length):!1}function Dt(e,{user:t}){var n;return X(e.value,((n=t.profile.history)==null?void 0:n.length)??0)}async function Ct(){const e=w("Shopify");if(!e)return{};const t=new Promise(n=>{e==null||e.loadFeatures([{name:"consent-tracking-api",version:"0.1"}],n)});return await Promise.race([t,N(1e3)]),e.customerPrivacy?{marketingAllowed:e.customerPrivacy.marketingAllowed(),saleOfDataAllowed:e.customerPrivacy.saleOfDataAllowed(),analyticsProcessingAllowed:e.customerPrivacy.analyticsProcessingAllowed(),preferencesProcessingAllowed:e.customerPrivacy.preferencesProcessingAllowed()}:{}}function Pt(e,t){return X(e.value,t.user.shopifyNumOrders??0)}function Tt(e,t){const n=t.user.country;if(n===null)return!0;const r=ee(e.countries).includes(n);return e.type==="shopify.inCountries"?r:!r}function kt(e,t){const n=t.user.market;return n===null?!0:e.type==="shopify.inMarkets"?e.markets.includes(n):!e.markets.includes(n)}function Rt(e,t){const n=t.user.language;return n===null?!0:e.type==="shopify.inLocales"?e.locales.includes(n):!e.locales.includes(n)}async function Lt(e){const{marketingAllowed:t,saleOfDataAllowed:n,analyticsProcessingAllowed:r,preferencesProcessingAllowed:s}=await Ct();return e.consentTypes.some(a=>{switch(a){case"marketing":return t;case"saleOfData":return n;case"analyticsProcessing":return r;case"preferencesProcessing":return s}})}function Nt(e,t){const n=we("utm_source",t.user),r=e.values.includes(n);return e.type==="traffic.utmSourceIsIn"?r:!r}function Ot(e,t){const n=we("utm_medium",t.user),r=e.values.includes(n);return e.type==="traffic.utmMediumIsIn"?r:!r}function we(e,{profile:t}){const n=t.history.flat();for(const r of n.reverse()){const s=Y(r),i=s==null?void 0:s.searchParams.get(e);if(i)return i}return null}function _t(e,t){return he(e.value,new Date(t.user.createdAt))}function bt(e,t){const n=t.user.isMobile;return n===null?!0:e.device==="mobile"?n:!n}function Mt(e,t){const n=t.user.ipCountry;if(n===null)return"skip";const r=ee(e.countries).includes(n);return e.type==="user.inCountries"?r:!r}function Ut(e,t){const n=t.user.ipCountry;if(n===null)return"skip";const s=Ge(e.continents).includes(n);return e.type==="user.inContinents"?s:!s}function Ft(e,t){const n=t.user.ipRegion;return n===null?"skip":e.type==="user.inRegions"?e.regions.includes(n):!e.regions.includes(n)}function Gt(e,t){const n=t.user.ipCity,r=t.user.ipRegion;if(n===null||r===null)return"skip";const s=e.cityRegions.some(i=>i.city===n&&i.region===r);return e.type==="user.inCityRegions"?s:!s}function Kt(e,t){const n=t.actions.some(r=>{if(e.action.type==="popupClose"){if(!(r.data.type==="popupClose"||r.data.type==="popupStep"&&r.data.isFloatingButton))return!1}else if(r.data.type!==e.action.type)return!1;return e.thisSession==="exclude"&&new Date(r.createdAt).getTime()>t.sessionStart?!1:e.filters?Bt(r,e.filters):!0});return e.type==="user.hasDoneAction"?!!n:!n}function Bt(e,t){return t.every(s=>{switch(s.type){case"userAction.date":return n(s);case"userAction.inSegments":case"userAction.notInSegments":return r(s)}});function n(s){return he(s.value,new Date(e.createdAt))}function r(s){const i=s.segmentIDs.some(a=>e.segmentID===a);return s.type==="userAction.inSegments"?i:!i}}async function Se(e,t){switch(e.type){case"inTargetingRule":case"notInTargetingRule":return St(e,t);case"customCode":return await It(e,t);case"klaviyo.identified":case"klaviyo.notIdentified":return await gt(e);case"klaviyo.inList":case"klaviyo.notInList":return await pt(e);case"klaviyo.inSegment":case"klaviyo.notInSegment":return await mt(e);case"isOnPage":case"isNotOnPage":case"hasVisitedPage":case"hasNotVisitedPage":return At(e,t);case"pages.numPagesViewed":return Et(e,t);case"pages.numSessions":return Dt(e,t);case"shopify.numOrders":return Pt(e,t);case"shopify.inMarkets":case"shopify.notInMarkets":return kt(e,t);case"shopify.inLocales":case"shopify.notInLocales":return Rt(e,t);case"shopify.inCountries":case"shopify.notInCountries":return Tt(e,t);case"user.inCityRegions":case"user.notInCityRegions":return Gt(e,t);case"shopify.customerPrivacyAllowed":return Lt(e);case"user.createdAt":return _t(e,t);case"user.device":return bt(e,t);case"user.inCountries":case"user.notInCountries":return Mt(e,t);case"user.inContinents":case"user.notInContinents":return Ut(e,t);case"user.inRegions":case"user.notInRegions":return Ft(e,t);case"user.hasDoneAction":case"user.hasNotDoneAction":return Kt(e,t);case"traffic.utmSourceIsIn":case"traffic.utmSourceIsNotIn":return Nt(e,t);case"traffic.utmMediumIsIn":case"traffic.utmMediumIsNotIn":return Ot(e,t);case"cookie.identified":case"cookie.notIdentified":return vt(e)}}async function q(e,t){switch(e.type){case"and":return Vt(e,t);case"or":return $t(e,t)}}async function Vt(e,t){const n=await Promise.all(e.conds.map(r=>Se(r,t)));return n.some(r=>r===!1)?!1:n.some(r=>r==="skip")?"skip":!0}async function $t(e,t){const n=await Promise.all(e.conds.map(r=>Se(r,t)));return n.some(r=>r===!0)?!0:n.some(r=>r==="skip")?"skip":!1}const Ie=[];async function Ht({user:e,actions:t,targetingRules:n,segments:r,integrationUsers:s}){return(await Promise.all(r.map(async a=>{try{return await q(a.targeting.rule,{user:e,actions:t,integrationUsers:s,evaluated:[],targetingRules:n,segments:r,segmentID:a.id,sessionStart:le().start})===!1?void 0:a.id}catch(l){if(y.error(l),Ie.includes(a.id))return;j({message:`Error evaluating targeting rule: ${M(l)}`,data:{error:M(l)},bucket:"merchant_error"}),Ie.push(a.id);return}}))).filter(a=>a!==void 0)}const H=()=>"shawtyactivewear.myshopify.com".substring(0);y.log(H());const F=()=>w("ALIA_SHOPIFY_EXTENSION_INFO"),Wt="https://backend.alia-cloudflare.com",ve="v3.3.34",Ae=5,Yt=1e3;C().readyState!=="loading"?Q():C().addEventListener("DOMContentLoaded",()=>{Q()},{once:!0});async function Q(e=Ae){const t="ALIA_HAS_INITIALIZED";if(w(t)){y.log("Alia already initialized");return}if(U(t,!0),n()){y.log("Disabled for bot",navigator.userAgent);return}try{await Jt()}catch(r){if(e<=0){y.error(`Failed after ${Ae} tries`),j({message:"Init failed",data:{error:M(r)}});return}else y.error("Init failed, trying again...",r),await N(2e3),Q(e-1)}function n(){const r=navigator.userAgent;return["Googlebot","bingbot","facebookexternalhit","Storebot-Google","AmazonProductDiscovery","Petalbot","Pinterestbot","Applebot","Twitterbot","meta-externalads","AdsBot-Google"].some(s=>r.includes(s))}}async function Jt(){var Ce,Pe,Te,ke;const e=await Zt();qe();const t=new de,n=at(),{jwt:r,disabledReason:s,...i}=await tt({path:window.location.pathname+location.search,url:window.location.href,is_mobile:window.innerWidth<1024,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,ip_address:e,user_agent:navigator.userAgent,country:(n==null?void 0:n.country)??((Ce=F())==null?void 0:Ce.country),market:(n==null?void 0:n.market)??((Pe=F())==null?void 0:Pe.market),language:(n==null?void 0:n.language)??((Te=F())==null?void 0:Te.language),release_tag:ve,new_session:t.tracker.isNewSession,ip_country:(n==null?void 0:n.ipCountry)??void 0,ip_region:(n==null?void 0:n.ipRegion)??void 0,ip_city:(n==null?void 0:n.ipCity)??void 0});if(ue(r),Qe(r,(ke=i.merchant)==null?void 0:ke.settings),s){y.debug("Disabled",s);return}t.handleNewSession();let a=!1,l=!1,u,o,c;const S=[],p=[],I=[],T=[];let k;R();async function R(){k&&clearTimeout(k),await G(),!O().flowID&&(k=setTimeout(R,Yt))}async function G(){var Le;const{flowID:f}=O(),m=new Set;f||((await Ht({...i,actions:(c==null?void 0:c.state.actions)??i.actions,user:(c==null?void 0:c.state.user)??i.user,segments:i.segments.filter(E=>!p.includes(E.id))})).forEach(E=>m.add(E)),S.forEach(E=>m.add(E)));const d=Array.from(m).filter(h=>!p.includes(h));a||(f?y.debug("Previewing popup",f):d.length||y.debug("No matching campaigns")),p.push(...d);const g=d.length||f,[Re]=await Promise.all([f?_():jt(d),g?xt():void 0]);a||(u=w("alia"),o=We(u??[]),o.listen({type:"open",callback:({ignoreTargeting:h,campaignID:E})=>{const z=Number(E);h===!0&&!isNaN(z)&&i.segments.some(qt=>qt.id===z)&&(S.push(z),R())},retroactive:!0}),c=new it({actions:rt(i.actions),modalFlowID:Xt(Re),user:i.user}));for(const h of Re){if(!((Le=h.userFlow)!=null&&Le.flowID)||I.includes(h.userFlow.flowID))continue;I.push(h.userFlow.flowID),Je({type:"campaignMatched",campaignID:h.userFlow.segmentID,campaignTitle:h.userFlow.segmentTitle??void 0,popupID:h.userFlow.flowID,popupTitle:h.userFlow.flowTitle??void 0});const E=C().createElement("div");E.style.position="fixed",C().body.appendChild(E),T.push(window.mountAliaCustomerApp({shop:H(),jwt:r,useShadowDOM:h.settings.useShadowDOM,initialData:h,targetingArgs:i,evaluateTargetingRule:q,target:E,messages:o,mediator:c}))}a||(a=!0,De(),U("alia",{unmount:()=>T.forEach(h=>h()),push:o.push,messages:o,open:o.open,close:o.close,mediator:c}))}async function _(){const{flowID:f,key:m}=O();return f?[await et({previewKey:m??"",flowID:f})]:[]}const Ee=new Set;async function jt(f){if(!f.length)return[];const d=(await ze({segmentIDs:f})).filter(({userFlow:g})=>!(g!=null&&g.flowID)||!Ee.has(g.flowID));return d.forEach(({userFlow:g})=>{g!=null&&g.flowID&&Ee.add(g.flowID),g&&y.debug(`Matched campaign ${g.segmentID} (${g.segmentTitle}), serving flow ${g.flowID} (${g.flowTitle})`),new de(g==null?void 0:g.flowID).handleNewSession()}),d}async function Zt(){try{const f=await fetch("https://api.ipify.org");return f.status!==200?void 0:await f.text()}catch{return}}async function xt(){l||(await je(Wt+`/public/app.js?tag=${encodeURIComponent(ve)}`),l=!0)}function Xt(f){for(const m of f.map(d=>d.userFlow)){const d=m==null?void 0:m.state.steps.at(-1);if((d==null?void 0:d.step)==="popup"&&!(d!=null&&d.floatingButton))return m==null?void 0:m.flowID}}function De(){try{const f=w("onAliaReady"),m=d=>{typeof d=="function"&&d()};Array.isArray(f)?f.forEach(m):m(f),U("onAliaReady",void 0),setTimeout(De,1e3)}catch(f){console.error("Error calling executeOnReady",f)}}}return D.SHOP=H,D.shopifyExtensionInfo=F,Object.defineProperty(D,Symbol.toStringTag,{value:"Module"}),D}({});
